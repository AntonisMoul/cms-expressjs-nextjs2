// Blog Plugin Database Schema

model Post {
  id            Int      @id @default(autoincrement())
  name          String   @db.VarChar(120)
  description   String?  @db.VarChar(400)
  content       String?  @db.Text
  status        String   @default("published") @db.VarChar(60)
  authorId      Int?
  authorType    String?  @default("Botble\\ACL\\Models\\User") @db.VarChar(255)
  isFeatured    Boolean  @default(false) @db.TinyInt
  image         String?  @db.VarChar(255)
  views         Int      @default(0)
  formatType    String?  @db.VarChar(30)
  translationGroupId String? @db.VarChar(36) // UUID for linking translations

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User? @relation(fields: [authorId], references: [id], onDelete: SetNull)
  categories PostCategory[]
  tags PostTag[]
  translations PostTranslation[]
  meta PostMeta[]

  @@map("posts")
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(120)
  parentId    Int      @default(0)
  description String?  @db.VarChar(400)
  status      String   @default("published") @db.VarChar(60)
  authorId    Int?
  authorType  String?  @default("Botble\\ACL\\Models\\User") @db.VarChar(255)
  icon        String?  @db.VarChar(60)
  order       Int      @default(0)
  isFeatured  Boolean  @default(false) @db.TinyInt
  isDefault   Boolean  @default(false) @db.TinyInt

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User? @relation(fields: [authorId], references: [id], onDelete: SetNull)
  posts PostCategory[]
  children Category[] @relation("CategoryHierarchy")
  parent Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])

  @@map("categories")
}

model Tag {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(120)
  authorId    Int?
  authorType  String?  @default("Botble\\ACL\\Models\\User") @db.VarChar(255)
  description String?  @db.VarChar(400)
  status      String   @default("published") @db.VarChar(60)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  author User? @relation(fields: [authorId], references: [id], onDelete: SetNull)
  posts PostTag[]

  @@map("tags")
}

model PostCategory {
  postId     Int
  categoryId Int

  // Relations
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@id([postId, categoryId])
  @@map("post_categories")
}

model PostTag {
  postId Int
  tagId  Int

  // Relations
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag Tag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([postId, tagId])
  @@map("post_tags")
}

model PostTranslation {
  langCode  String @db.VarChar(20)
  postsId   Int
  name      String? @db.VarChar(120)
  description String? @db.VarChar(400)
  content   String? @db.Text

  // Relations
  post Post @relation(fields: [postsId], references: [id], onDelete: Cascade)

  @@id([langCode, postsId])
  @@map("post_translations")
}

model PostMeta {
  id     Int    @id @default(autoincrement())
  key    String @db.VarChar(120)
  value  String? @db.Text
  postId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([key, postId])
  @@index([postId])
  @@map("post_meta")
}

// Extend the core User model to include blog relations
model User {
  // ... existing fields from core schema
  posts Post[]
  categories Category[]
  tags Tag[]
}
